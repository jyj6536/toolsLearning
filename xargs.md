# xargs

`xargs` 是一个用于从标准输入构建和执行命令行的命令。它从标准输入读取项目，项目之间以空格（可以用双引号、单引号或反斜杠进行保护）或换行符分隔，然后执行命令（默认为 `/bin/echo`）一次或多次，初始参数后面跟着从标准输入读取的项目。`xargs` 的主要工作流程包括：

1. **读取输入**：`xargs` 从标准输入读取数据，可以是通过管道传递的输入或指定的文件中的内容。
2. **分割和转换**：默认情况下，`xargs` 使用空格或换行符将输入分割成多个参数。但是，使用 `-0` 选项可以将输入项以空字符（null）分隔，这在处理文件名包含空格或特殊字符时特别有用。
3. **构建命令行**：将从输入中读取的参数与指定的命令及其初始参数结合，构建新的命令行。例如，`find . -name "*.txt" | xargs rm` 将 `rm` 命令作用于 `find` 命令找到的所有 `.txt` 文件。
4. **执行命令**：`xargs` 将构建好的命令行传递给操作系统执行。这使得用户可以轻松地处理大量文件或数据，而无需手动编写循环或脚本。

## 语法

```
xargs [选项] [命令 [初始参数]]
```

## 选项

- **-0, --null**: 输入项目以空字符而非空格终止，引号和反斜杠不起特殊作用（推荐用于处理包含空格的文件名）。
- **-a file, --arg-file=file**: 从文件中而非标准输入读取参数。
- **-E eof-str, --end-of-file=eof-str**: 将文件结束字符串设置为 eof-str。
- **-I replace-str, --replace[=replace-str]**: 在初始参数中用从标准输入读取的名称替换 replace-str 的出现。
- **-p, --interactive**: 在执行每个命令行之前提示。
- **-n max-args, --max-args=max-args**: 每个命令行最多使用 max-args 个参数。
- **-r, --no-run-if-empty**: 如果标准输入不包含非空白字符，则不运行命令。
- **-P**:指定并发执行的数量，0表示尽可能多地利用CPU

## 分割

xargs命令会将接收的stdin所有的空白（空格、制表符、换行符）都转换为空格。我们使用xargs -d "xx"自定义规则对数据进行切分。默认情况下，xargs使用空格来切分数据。

~~~sehll
vbubuntu@node1:~$ echo -e "aa aa aa\t1\t1"|xargs
aa aa aa 1 1
vbubuntu@node1:~$ echo -e "a1b1c1d1e"|xargs -d "1"                 
a b c d e
~~~

xargs -0的行为和xargs -d基本一样，只是-d是指定分割符，-0是指定固定的\0作为分割符。等价于xargs -d "\0"。该选项通常与`find -print0` 配合使用，用于处理文件名中包含特殊字符的文件

## 分批

-n 和 -L 可以分批处理，区别在于 -n 按空格分批，-L 按换行符分批

~~~shell
vbubuntu@node1:~$ echo -e "1 1\n2 2\n3 3\n4 4\n5 5\n6 6\n"|xargs -n 2
1 1
2 2
3 3
4 4
5 5
6 6
vbubuntu@node1:~$ echo -e "1 1\n2 2\n3 3\n4 4\n5 5\n6 6\n"|xargs -L 2
1 1 2 2
3 3 4 4
5 5 6 6
~~~

## -i和-I

xargs -i选项在逻辑上用于接收传递的分批结果。

如果不使用-i，则默认是将分割处理后的结果整体传递到【命令的最尾部】。但是有时候需要传递到多个位置，不使用-i就不知道传递到哪个位置了。

例如：重命名备份的时候在每个传递过来的文件名加上后缀.bak，这需要两个参数位。

使用xargs -i时以大括号{}作为替换符号，传递的时候看到{}就将结果替换，可以将{}放在任意需要传递的参数位置上。如果多个地方使用{}就实现了多个传递。

xargs -I和xargs -i是一样的，只是-i默认使用大括号作为替换符号，-I可以指定其他符号、字母、数字作为替换符号。

~~~~shell
echo -e "1 1\n2 2\n3 3\n4 4\n5 5\n6 6\n"|xargs  -I aaa echo aaa,aaa    
1 1,1 1
2 2,2 2
3 3,3 3
4 4,4 4
5 5,5 5
6 6,6 6
vbubuntu@node1:~$ echo -e "1 1\n2 2\n3 3\n4 4\n5 5\n6 6\n"|xargs  -i echo {},{}   
1 1,1 1
2 2,2 2
3 3,3 3
4 4,4 4
5 5,5 5
6 6,6 6
~~~~

